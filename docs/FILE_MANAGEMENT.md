# æ–‡ä»¶ç®¡ç†å’Œæœç´¢ç´¢å¼•æ›´æ–°ç³»çµ±

## æ¦‚è¿°

æœ¬ç³»çµ±æä¾›äº†å®Œæ•´çš„æ–‡ä»¶ç®¡ç†å’Œæœç´¢ç´¢å¼•æ›´æ–°è§£æ±ºæ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

- **æ–°èæ–‡ä»¶æ¸…ç†å’Œæ­¸æª”**ï¼šè‡ªå‹•ç®¡ç†æ–°èæ–‡ä»¶çš„å­˜å„²ç©ºé–“
- **æœç´¢ç´¢å¼•æ›´æ–°**ï¼šç¢ºä¿æœç´¢åŠŸèƒ½èˆ‡æœ€æ–°æ•¸æ“šåŒæ­¥
- **è‡ªå‹•åŒ–ä»»å‹™èª¿åº¦**ï¼šå®šæ™‚åŸ·è¡Œç¶­è­·ä»»å‹™
- **å®¢æˆ¶ç«¯è‡ªå‹•æ›´æ–°æª¢æ¸¬**ï¼šå¯¦æ™‚æ›´æ–°æœç´¢ç´¢å¼•

## ç³»çµ±æ¶æ§‹

```
src/server/
â”œâ”€â”€ news/
â”‚   â”œâ”€â”€ cleanup-news.js          # æ–°èæ–‡ä»¶æ¸…ç†ç®¡ç†å™¨
â”‚   â””â”€â”€ update-all-news.js       # æ•´åˆçš„æ–°èæ›´æ–°è…³æœ¬
â”œâ”€â”€ search/
â”‚   â””â”€â”€ update-indexes.js        # æœç´¢ç´¢å¼•æ›´æ–°å™¨
â””â”€â”€ scheduler/
    â””â”€â”€ automated-tasks.js       # è‡ªå‹•åŒ–ä»»å‹™èª¿åº¦å™¨

config/
â””â”€â”€ scheduler.config.js          # èª¿åº¦å™¨é…ç½®æ–‡ä»¶

data/
â”œâ”€â”€ news/                        # æ´»èºæ–°èæ–‡ä»¶
â”œâ”€â”€ news-archive/                # æ­¸æª”æ–°èæ–‡ä»¶
â”œâ”€â”€ news-compressed/             # å£“ç¸®æ–°èæ–‡ä»¶
â”œâ”€â”€ cleanup-log.json             # æ¸…ç†æ“ä½œæ—¥èªŒ
â”œâ”€â”€ search-update-log.json       # æœç´¢æ›´æ–°æ—¥èªŒ
â”œâ”€â”€ search-update-signal.json    # æœç´¢æ›´æ–°ä¿¡è™Ÿ
â””â”€â”€ scheduler-log.json           # èª¿åº¦å™¨æ—¥èªŒ
```

## æ–°èæ–‡ä»¶ç®¡ç†

### æ¸…ç†ç­–ç•¥

ç³»çµ±æ¡ç”¨ä¸‰å±¤æ¸…ç†ç­–ç•¥ï¼š

1. **å£“ç¸®éšæ®µ**ï¼ˆ7å¤©å¾Œï¼‰
   - ç§»é™¤ä¸å¿…è¦çš„å­—æ®µ
   - ä¿ç•™æ ¸å¿ƒä¿¡æ¯
   - ç¯€çœç´„30-50%å­˜å„²ç©ºé–“

2. **æ­¸æª”éšæ®µ**ï¼ˆ14å¤©å¾Œï¼‰
   - ç§»å‹•åˆ°æ­¸æª”ç›®éŒ„
   - ä¿æŒå®Œæ•´æ•¸æ“šçµæ§‹
   - ä¾¿æ–¼æ­·å²æŸ¥è©¢

3. **åˆªé™¤éšæ®µ**ï¼ˆ30å¤©å¾Œï¼‰
   - æ°¸ä¹…åˆªé™¤éæœŸæ–‡ä»¶
   - é‡‹æ”¾å­˜å„²ç©ºé–“
   - ç¶­è­·æ­¸æª”ç›®éŒ„å¤§å°é™åˆ¶

### ä½¿ç”¨æ–¹æ³•

```bash
# é‹è¡Œå®Œæ•´æ¸…ç†æµç¨‹
npm run cleanup:run

# ç”Ÿæˆæ¸…ç†å ±å‘Š
npm run cleanup:report

# æ¸¬è©¦æ¸…ç†åŠŸèƒ½ï¼ˆä½¿ç”¨è¼ƒçŸ­çš„ä¿ç•™æœŸé™ï¼‰
npm run cleanup:test
```

### é…ç½®é¸é …

åœ¨ `src/server/news/cleanup-news.js` ä¸­å¯ä»¥èª¿æ•´ï¼š

```javascript
this.config = {
    retentionDays: 30,        // ä¿ç•™30å¤©
    compressionDays: 7,        // 7å¤©å¾Œå£“ç¸®
    archiveDays: 14,           // 14å¤©å¾Œæ­¸æª”
    maxArchiveSize: 100 * 1024 * 1024, // 100MB æ­¸æª”é™åˆ¶
};
```

## æœç´¢ç´¢å¼•æ›´æ–°

### æ›´æ–°ç­–ç•¥

1. **å¢é‡æ›´æ–°**
   - æª¢æŸ¥æ•¸æ“šæ–‡ä»¶è®Šæ›´
   - åƒ…åœ¨å¿…è¦æ™‚æ›´æ–°ç´¢å¼•
   - æé«˜æ›´æ–°æ•ˆç‡

2. **å®Œæ•´æ›´æ–°**
   - é‡æ–°é©—è­‰æ‰€æœ‰æ•¸æ“š
   - ç”Ÿæˆå®Œæ•´çµ±è¨ˆä¿¡æ¯
   - ç¢ºä¿æ•¸æ“šä¸€è‡´æ€§

3. **è‡ªå‹•æ›´æ–°æª¢æ¸¬**
   - å®¢æˆ¶ç«¯å®šæœŸæª¢æŸ¥æ›´æ–°ä¿¡è™Ÿ
   - é é¢å¯è¦‹æ€§è®ŠåŒ–æ™‚æª¢æŸ¥
   - ç„¡ç¸«æ›´æ–°é«”é©—

### ä½¿ç”¨æ–¹æ³•

```bash
# åŸ·è¡Œå®Œæ•´æœç´¢ç´¢å¼•æ›´æ–°
npm run search:update

# åŸ·è¡Œå¢é‡æ›´æ–°æª¢æŸ¥
npm run search:incremental

# ç”Ÿæˆæœç´¢æ›´æ–°å ±å‘Š
npm run search:report

# é©—è­‰æ•¸æ“šå®Œæ•´æ€§
npm run search:validate

# æ¸…ç†èˆŠçš„æ›´æ–°ä¿¡è™Ÿ
npm run search:cleanup
```

### æ›´æ–°ä¿¡è™Ÿæ©Ÿåˆ¶

ç³»çµ±ä½¿ç”¨ `search-update-signal.json` æ–‡ä»¶ä½œç‚ºæ›´æ–°ä¿¡è™Ÿï¼š

```json
{
    "timestamp": "2024-01-01T12:00:00.000Z",
    "version": "1.0",
    "dataFiles": {
        "ranked-news-index.json": {
            "exists": true,
            "lastModified": "2024-01-01T12:00:00.000Z",
            "size": 1024000,
            "recordCount": 100
        }
    }
}
```

## è‡ªå‹•åŒ–ä»»å‹™èª¿åº¦

### é è¨­ä»»å‹™

1. **æ–°èæ›´æ–°ä»»å‹™**
   - é »ç‡ï¼šæ¯6å°æ™‚
   - é¡å‹ï¼šå®Œæ•´æ›´æ–°
   - åŒ…å«ï¼šé—œéµè©ã€æ–°èã€è™•ç†ã€æ¸…ç†ã€æœç´¢æ›´æ–°

2. **æ¸…ç†ä»»å‹™**
   - é »ç‡ï¼šæ¯å¤©å‡Œæ™¨2é»
   - é¡å‹ï¼šæ–‡ä»¶æ¸…ç†
   - åŒ…å«ï¼šå£“ç¸®ã€æ­¸æª”ã€åˆªé™¤

3. **æœç´¢æ›´æ–°ä»»å‹™**
   - é »ç‡ï¼šæ¯2å°æ™‚
   - é¡å‹ï¼šå¢é‡æ›´æ–°
   - åŒ…å«ï¼šç´¢å¼•é©—è­‰å’Œæ›´æ–°

### ä½¿ç”¨æ–¹æ³•

```bash
# å•Ÿå‹•èª¿åº¦å™¨
npm run scheduler:start

# åœæ­¢èª¿åº¦å™¨
npm run scheduler:stop

# æŸ¥çœ‹èª¿åº¦å™¨ç‹€æ…‹
npm run scheduler:status

# ç«‹å³åŸ·è¡Œç‰¹å®šä»»å‹™
npm run scheduler:news
npm run scheduler:cleanup
npm run scheduler:search

# é‡æ–°åŠ è¼‰é…ç½®
npm run scheduler:reload
```

### é…ç½®èª¿åº¦å™¨

ç·¨è¼¯ `config/scheduler.config.js`ï¼š

```javascript
module.exports = {
    enabled: true,
    tasks: {
        newsUpdate: {
            enabled: true,
            schedule: '0 */6 * * *', // æ¯6å°æ™‚
            type: 'full'
        },
        cleanup: {
            enabled: true,
            schedule: '0 2 * * *', // æ¯å¤©å‡Œæ™¨2é»
            type: 'cleanup'
        },
        searchUpdate: {
            enabled: true,
            schedule: '0 */2 * * *', // æ¯2å°æ™‚
            type: 'incremental'
        }
    },
    notifications: {
        enabled: true,
        webhook: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL',
        email: {
            host: 'smtp.gmail.com',
            port: 587,
            user: 'your@email.com',
            pass: 'your-password'
        }
    }
};
```

### Cron è¡¨é”å¼æ ¼å¼

```
* * * * *
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ æ˜ŸæœŸå¹¾ (0-7, 0å’Œ7éƒ½ä»£è¡¨æ˜ŸæœŸæ—¥)
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€ æœˆä»½ (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€ æ—¥æœŸ (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€ å°æ™‚ (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é˜ (0-59)
```

å¸¸ç”¨è¡¨é”å¼ï¼š
- `0 */6 * * *` - æ¯6å°æ™‚
- `0 2 * * *` - æ¯å¤©å‡Œæ™¨2é»
- `0 */2 * * *` - æ¯2å°æ™‚
- `0 0 * * 0` - æ¯é€±æ—¥åˆå¤œ

## å®¢æˆ¶ç«¯è‡ªå‹•æ›´æ–°

### æ›´æ–°æª¢æ¸¬æ©Ÿåˆ¶

1. **å®šæœŸæª¢æŸ¥**ï¼šæ¯5åˆ†é˜æª¢æŸ¥ä¸€æ¬¡æ›´æ–°ä¿¡è™Ÿ
2. **é é¢å¯è¦‹æ€§**ï¼šé é¢é‡æ–°å¯è¦‹æ™‚æª¢æŸ¥æ›´æ–°
3. **ç‹€æ…‹æŒ‡ç¤º**ï¼šå¯¦æ™‚é¡¯ç¤ºæœç´¢ç³»çµ±ç‹€æ…‹
4. **ç„¡ç¸«æ›´æ–°**ï¼šå¾Œå°æ›´æ–°ï¼Œä¸å½±éŸ¿ç”¨æˆ¶é«”é©—

### ç‹€æ…‹æŒ‡ç¤ºå™¨

- ğŸŸ¢ **Ready**ï¼šæœç´¢ç³»çµ±æ­£å¸¸é‹è¡Œ
- ğŸŸ¡ **Loading**ï¼šæ­£åœ¨ç´¢å¼•æˆ–æ›´æ–°æ•¸æ“š
- ğŸ”´ **Error**ï¼šæœç´¢ç³»çµ±å‡ºç¾éŒ¯èª¤
- ğŸ”µ **Info**ï¼šä¸€èˆ¬ä¿¡æ¯ç‹€æ…‹

### æ›´æ–°é€šçŸ¥

ç•¶æœç´¢ç´¢å¼•æ›´æ–°æ™‚ï¼Œæœƒé¡¯ç¤ºé€šçŸ¥ï¼š

```
ğŸ”„ Search indexes updated
```

é€šçŸ¥æœƒåœ¨3ç§’å¾Œè‡ªå‹•æ¶ˆå¤±ï¼Œä¹Ÿå¯ä»¥æ‰‹å‹•é—œé–‰ã€‚

## æ•´åˆä½¿ç”¨

### å®Œæ•´æ›´æ–°æµç¨‹

```bash
# 1. æ›´æ–°æ–°èå’Œé—œéµè©
npm run news:update-all

# 2. æ¸…ç†èˆŠæ–‡ä»¶
npm run cleanup:run

# 3. æ›´æ–°æœç´¢ç´¢å¼•
npm run search:update

# 4. æŸ¥çœ‹å ±å‘Š
npm run news:report
npm run cleanup:report
npm run search:report
```

### å¿«é€Ÿæ›´æ–°æµç¨‹

```bash
# å¿«é€Ÿæ›´æ–°ï¼ˆæ–°èè™•ç† + æœç´¢ç´¢å¼•ï¼‰
npm run news:quick-update
```

### è‡ªå‹•åŒ–æµç¨‹

```bash
# å•Ÿå‹•è‡ªå‹•åŒ–èª¿åº¦å™¨
npm run scheduler:start

# æŸ¥çœ‹èª¿åº¦å™¨ç‹€æ…‹
npm run scheduler:status
```

## ç›£æ§å’Œæ—¥èªŒ

### æ—¥èªŒæ–‡ä»¶

- `data/cleanup-log.json` - æ¸…ç†æ“ä½œæ—¥èªŒ
- `data/search-update-log.json` - æœç´¢æ›´æ–°æ—¥èªŒ
- `data/scheduler-log.json` - èª¿åº¦å™¨æ—¥èªŒ
- `data/update-log.json` - æ–°èæ›´æ–°æ—¥èªŒ

### æ—¥èªŒæ ¼å¼

```json
{
    "operations": [
        {
            "timestamp": "2024-01-01T12:00:00.000Z",
            "operation": "cleanup",
            "details": {
                "success": true,
                "summary": {
                    "compressed": 5,
                    "archived": 3,
                    "deleted": 2
                }
            }
        }
    ],
    "lastUpdated": "2024-01-01T12:00:00.000Z"
}
```

### å¥åº·æª¢æŸ¥

```bash
# æª¢æŸ¥ç³»çµ±å¥åº·ç‹€æ…‹
npm run health-check
```

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **æ¸…ç†å¤±æ•—**
   - æª¢æŸ¥æ–‡ä»¶æ¬Šé™
   - ç¢ºèªç›®éŒ„å­˜åœ¨
   - æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ

2. **æœç´¢æ›´æ–°å¤±æ•—**
   - é©—è­‰æ•¸æ“šæ–‡ä»¶å®Œæ•´æ€§
   - æª¢æŸ¥æ–‡ä»¶æ ¼å¼
   - ç¢ºèªä¾è³´é …

3. **èª¿åº¦å™¨ä¸å·¥ä½œ**
   - æª¢æŸ¥é…ç½®æ–‡ä»¶
   - ç¢ºèª cron è¡¨é”å¼æ ¼å¼
   - æŸ¥çœ‹èª¿åº¦å™¨æ—¥èªŒ

### èª¿è©¦å‘½ä»¤

```bash
# æ¸¬è©¦æ¸…ç†åŠŸèƒ½
npm run cleanup:test

# é©—è­‰æœç´¢æ•¸æ“š
npm run search:validate

# æŸ¥çœ‹è©³ç´°å ±å‘Š
npm run scheduler:status
```

## æ€§èƒ½å„ªåŒ–

### å­˜å„²å„ªåŒ–

- å£“ç¸®å¯ç¯€çœ30-50%å­˜å„²ç©ºé–“
- æ­¸æª”ç®¡ç†é˜²æ­¢ç„¡é™å¢é•·
- è‡ªå‹•æ¸…ç†éæœŸæ–‡ä»¶

### æ›´æ–°å„ªåŒ–

- å¢é‡æ›´æ–°æ¸›å°‘è™•ç†æ™‚é–“
- æ™ºèƒ½æª¢æ¸¬é¿å…ä¸å¿…è¦çš„æ›´æ–°
- å¾Œå°æ›´æ–°ä¸å½±éŸ¿ç”¨æˆ¶é«”é©—

### ç›£æ§å„ªåŒ–

- è©³ç´°æ—¥èªŒä¾¿æ–¼å•é¡Œè¨ºæ–·
- ç‹€æ…‹å ±å‘Šæä¾›ç³»çµ±æ¦‚è¦½
- è‡ªå‹•é€šçŸ¥åŠæ™‚ç™¼ç¾å•é¡Œ

## æœ€ä½³å¯¦è¸

1. **å®šæœŸç›£æ§**ï¼šå®šæœŸæª¢æŸ¥ç³»çµ±ç‹€æ…‹å’Œæ—¥èªŒ
2. **å‚™ä»½é‡è¦æ•¸æ“š**ï¼šå®šæœŸå‚™ä»½é…ç½®å’Œé‡è¦æ•¸æ“š
3. **æ¸¬è©¦æ›´æ–°**ï¼šåœ¨ç”Ÿç”¢ç’°å¢ƒå‰æ¸¬è©¦æ›´æ–°æµç¨‹
4. **ç›£æ§å­˜å„²**ï¼šå®šæœŸæª¢æŸ¥å­˜å„²ä½¿ç”¨æƒ…æ³
5. **å„ªåŒ–é…ç½®**ï¼šæ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³èª¿æ•´é…ç½®

## æ›´æ–°æ—¥èªŒ

### v1.0.0 (2024-01-01)
- åˆå§‹ç‰ˆæœ¬ç™¼å¸ƒ
- å¯¦ç¾æ–°èæ–‡ä»¶æ¸…ç†å’Œæ­¸æª”
- å¯¦ç¾æœç´¢ç´¢å¼•è‡ªå‹•æ›´æ–°
- å¯¦ç¾è‡ªå‹•åŒ–ä»»å‹™èª¿åº¦
- å¯¦ç¾å®¢æˆ¶ç«¯è‡ªå‹•æ›´æ–°æª¢æ¸¬ 